# Настройка вывода комиссий в CryptoBot

## Проблема
Комиссии от пользователей не приходят на ваш кошелек CryptoBot.

## Решение

### 1. Установите ADMIN_CRYPTO_ID в .env файле

Добавьте или обновите строку в файле `.env`:

```env
ADMIN_CRYPTO_ID=U1077249
```

Или без префикса "U":
```env
ADMIN_CRYPTO_ID=1077249
```

**Ваш ID в CryptoBot test:** `U1077249`

### 2. Убедитесь что CRYPTO_BOT_TOKEN настроен

В `.env` должен быть токен CryptoBot:
```env
CRYPTO_BOT_TOKEN=ваш_токен_здесь
```

### 3. Проверьте режим (testnet/mainnet)

Если используете testnet, установите:
```env
CRYPTO_TESTNET=true
```

Если используете mainnet (продакшн), установите:
```env
CRYPTO_TESTNET=false
```
или просто удалите эту строку.

### 4. Как работает система комиссий

- **Комиссия:** 2% от суммы каждой открытой сделки
- **Авто-вывод:** Комиссии автоматически выводятся когда накапливается **$10.00** или больше
- **Минимальный вывод:** $1.00

### 5. Проверка работы

После перезапуска бота, в логах вы увидите:
```
[COMMISSION] ✅ ADMIN_CRYPTO_ID настроен: 1077249 (исходный: U1077249)
[COMMISSION] Порог авто-вывода: $10.00
[COMMISSION] Loaded from DB: $X.XX
```

При каждой сделке:
```
[COMMISSION] +$X.XX, накоплено: $X.XX
```

Когда накопится >= $10:
```
[COMMISSION] Попытка вывода $X.XX на ID 1077249 (testnet=True/False)
[COMMISSION] ✅ Выведено $X.XX на CryptoBot ID 1077249
```

### 6. Ручной вывод комиссий

Если нужно вывести комиссии вручную до достижения порога, используйте админ-команду `/commission` и нажмите кнопку "Вывести".

### 7. Возможные проблемы

**Проблема:** "ADMIN_CRYPTO_ID не настроен"
- **Решение:** Проверьте что в `.env` есть строка `ADMIN_CRYPTO_ID=U1077249`

**Проблема:** "Недостаточно USDT на балансе бота"
- **Решение:** Убедитесь что на балансе CryptoBot бота есть достаточно USDT для вывода

**Проблема:** "Неверный формат ADMIN_CRYPTO_ID"
- **Решение:** ID должен быть числом (с префиксом "U" или без него). Примеры: `U1077249`, `1077249`

**Проблема:** Комиссии не начисляются
- **Решение:** Комиссия начисляется только при **открытии** сделки, не при закрытии. Проверьте что сделки действительно открываются.

### 8. Проверка накопленных комиссий

Используйте админ-команду:
```
/commission
```

Это покажет:
- Сколько комиссий накоплено
- Сколько в ожидании вывода
- Текущий баланс CryptoBot
- Статус настроек
